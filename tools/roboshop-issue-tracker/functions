source /tmp/labautomation/dry/common-functions.sh

CASE() {
  case $1 in
    10) ## Nginx service failed and not running
       systemctl restart nginx
       netstat -lntp | grep nginx
       if [ $? -ne 0 ]; then
         systemctl status -l nginx
         ## something to fill
          echo -e "\n\e[1;33m Following are the errors \e[0m\n"
          grep 'nginx\[' /var/log/messages | tail -n 4
          grep 'nginx\[' /var/log/messages | tail -n 4 | grep 'host not found' &>/dev/null
          if [ $? -eq 0 ]; then
            hintt "Issue is DNS record not found which is used in the Nginx Server"
            hintt "Checking DNS Entries"
            for server in $(cat /etc/nginx/default.d/roboshop.conf  | grep /api/ | xargs -n1  | grep ^http | awk -F : '{print $2}' | sed -e 's|//||' |xargs); do
              hintt "Checking DNS record for - $server"
              host $server
              if [ $? -ne 0 ]; then
                hintt "DNS Check Failed - $server"
                SOLUTION 10
              fi
            done
          fi
      fi
    ;;
  esac
}


remote_command() {
  echo "$2" | ssh $1 2>&1 | sed -e 1,39d
}